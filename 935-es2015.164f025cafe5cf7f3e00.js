(self.webpackChunkmelodia_ui=self.webpackChunkmelodia_ui||[]).push([[935],{75935:function(e,t,s){"use strict";s.r(t),s.d(t,{AdminModule:function(){return J}});var n=s(38583),r=s(99763),i=s(55477),o=s(37716),c=s(92340),u=s(91841),a=s(86665);let l=(()=>{class e{constructor(e,t){this.httpClient=e,this.authService=t,this.authService.onTokenChange().subscribe(e=>{this.token=e.getValue()})}getLogs(e,t,s){let n=`${c.N.apiUrl}/api/admin/logs/page?`;return void 0!==e&&(n+=`index=${e}&`),void 0!==t&&(n+=`size=${t}&`),void 0!==s&&(n+=`ascendent=${s}&`),this.httpClient.get(n,{headers:{Authorization:this.token}})}}return e.\u0275fac=function(t){return new(t||e)(o.LFG(u.eN),o.LFG(a._o))},e.\u0275prov=o.Yz7({token:e,factory:e.\u0275fac}),e})();var d=s(13030);let g=(()=>{class e{constructor(){}ngOnInit(){}toNebularStatus(e){switch(e){case"INFO":return"basic";case"WARN":return"warning";case"ERROR":case"FATAL":return"danger";default:return"basic"}}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=o.Xpm({type:e,selectors:[["ngx-log"]],inputs:{log:"log"},decls:8,vars:4,consts:[[3,"status"],[1,"px-4"]],template:function(e,t){1&e&&(o.TgZ(0,"nb-alert",0),o.TgZ(1,"div"),o.TgZ(2,"span",1),o._uU(3),o.qZA(),o.TgZ(4,"span",1),o._uU(5),o.qZA(),o.TgZ(6,"span",1),o._uU(7),o.qZA(),o.qZA(),o.qZA()),2&e&&(o.Q6J("status",t.toNebularStatus(t.log.status)),o.xp6(3),o.Oqu(t.log.date),o.xp6(2),o.Oqu(t.log.status),o.xp6(2),o.Oqu(t.log.message))},directives:[d.$9b],styles:["[_nghost-%COMP%]{width:100%;margin:0}"]}),e})();function p(e,t){if(1&e&&(o.TgZ(0,"nb-list-item",3),o._UZ(1,"ngx-log",4),o.qZA()),2&e){const e=t.$implicit;o.xp6(1),o.Q6J("log",e)}}function h(e,t){1&e&&(o.TgZ(0,"nb-list-item",5),o._uU(1," Cargando... "),o.qZA())}let Z=(()=>{class e{constructor(e,t){this.adminService=e,this.toastrService=t,this.firstCard={logs:[],placeholders:[],loading:!1,pageToLoadNext:0},this.pageSize=5}loadNext(e){e.loading||(e.loading=!0,e.placeholders=new Array(this.pageSize),this.adminService.getLogs(e.pageToLoadNext,this.pageSize,!1).subscribe(t=>{e.placeholders=[],e.logs.push(...t.content),e.loading=!1,e.pageToLoadNext++},e=>{this.toastrService.danger(e.error.message,"ERROR")}))}}return e.\u0275fac=function(t){return new(t||e)(o.Y36(l),o.Y36(d.quB))},e.\u0275cmp=o.Xpm({type:e,selectors:[["ngx-logs"]],decls:7,vars:3,consts:[["nbInfiniteList","",3,"threshold","bottomThreshold"],["class","p-0",4,"ngFor","ngForOf"],["nbSpinner","true",4,"ngFor","ngForOf"],[1,"p-0"],[3,"log"],["nbSpinner","true"]],template:function(e,t){1&e&&(o.TgZ(0,"nb-card"),o.TgZ(1,"nb-card-header"),o._uU(2,"Logs"),o.qZA(),o.TgZ(3,"nb-card-body"),o.TgZ(4,"nb-list",0),o.NdJ("bottomThreshold",function(){return t.loadNext(t.firstCard)}),o.YNc(5,p,2,1,"nb-list-item",1),o.YNc(6,h,2,0,"nb-list-item",2),o.qZA(),o.qZA(),o.qZA()),2&e&&(o.xp6(4),o.Q6J("threshold",500),o.xp6(1),o.Q6J("ngForOf",t.firstCard.logs),o.xp6(1),o.Q6J("ngForOf",t.firstCard.placeholders))},directives:[d.Asz,d.ndF,d.yKW,d.zP_,d.sTn,n.sg,d.qBV,g,d.Q7R],styles:["nb-list[_ngcontent-%COMP%]{max-height:500px}"]}),e})(),m=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=o.Xpm({type:e,selectors:[["ngx-admin"]],decls:1,vars:0,template:function(e,t){1&e&&o._UZ(0,"router-outlet")},directives:[r.lC],encapsulation:2}),e})();var f=s(91e3),b=s(3679);function v(e,t){if(1&e){const e=o.EpF();o.TgZ(0,"nb-option",14),o.NdJ("click",function(){const t=o.CHM(e).$implicit;return o.oxw().selectRole(t)}),o._uU(1),o.qZA()}if(2&e){const e=t.$implicit;o.Q6J("value",e.id),o.xp6(1),o.Oqu(e.name)}}let q=(()=>{class e{constructor(){this.userEventEmitter=new o.vpe}ngOnInit(){this.editedUser=new f.n5,this.editedUser.id=this.user.id,this.editedUser.name=this.user.name,this.editedUser.roles=this.user.roles,this.editedUser.enabled=this.user.enabled,this.editedUser.email=this.user.email,this.editedUser.surname=this.user.surname}findRolesIds(e){return e.roles.map(e=>e.id)}selectRole(e){this.editedUser.roles.filter(t=>t.id===e.id).length>0?this.editedUser.roles=this.editedUser.roles.filter(t=>t.id!==e.id):this.editedUser.roles.push(e)}isModified(){return this.user===this.editedUser}emitResult(){this.userEventEmitter.emit(this.editedUser)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=o.Xpm({type:e,selectors:[["ngx-user-form"]],inputs:{user:"user",roles:"roles"},outputs:{userEventEmitter:"userEventEmitter"},decls:25,vars:6,consts:[[1,"m-4"],["for","name"],["id","name","type","text","nbInput","","fullWidth","","status","basic",3,"ngModel","ngModelChange"],["for","surname"],["id","surname","type","text","nbInput","","fullWidth","","status","basic",3,"ngModel","ngModelChange"],["for","email"],["nbPrefix","","icon","at-outline"],["id","email","type","email","nbInput","","fullWidth","","status","basic",3,"ngModel","ngModelChange"],["for","roles"],["id","roles","multiple","","fullWidth","",3,"selected"],[3,"value","click",4,"ngFor","ngForOf"],["for","enabled"],["id","enabled"],[3,"checked","checkedChange"],[3,"value","click"]],template:function(e,t){1&e&&(o.TgZ(0,"div"),o.TgZ(1,"div",0),o.TgZ(2,"label",1),o._uU(3,"Nombre:"),o.qZA(),o.TgZ(4,"input",2),o.NdJ("ngModelChange",function(e){return t.editedUser.name=e}),o.qZA(),o.qZA(),o.TgZ(5,"div",0),o.TgZ(6,"label",3),o._uU(7,"Apellidos:"),o.qZA(),o.TgZ(8,"input",4),o.NdJ("ngModelChange",function(e){return t.editedUser.surname=e}),o.qZA(),o.qZA(),o.TgZ(9,"div",0),o.TgZ(10,"label",5),o._uU(11,"Email:"),o.qZA(),o.TgZ(12,"nb-form-field"),o._UZ(13,"nb-icon",6),o.TgZ(14,"input",7),o.NdJ("ngModelChange",function(e){return t.editedUser.email=e}),o.qZA(),o.qZA(),o.qZA(),o.TgZ(15,"div",0),o.TgZ(16,"label",8),o._uU(17,"Roles:"),o.qZA(),o.TgZ(18,"nb-select",9),o.YNc(19,v,2,2,"nb-option",10),o.qZA(),o.qZA(),o.TgZ(20,"div",0),o.TgZ(21,"label",11),o._uU(22,"Enabled:"),o.qZA(),o.TgZ(23,"div",12),o.TgZ(24,"nb-toggle",13),o.NdJ("checkedChange",function(){return t.editedUser.enabled=!t.editedUser.enabled}),o.qZA(),o.qZA(),o.qZA(),o.qZA()),2&e&&(o.xp6(4),o.Q6J("ngModel",t.editedUser.name),o.xp6(4),o.Q6J("ngModel",t.editedUser.surname),o.xp6(6),o.Q6J("ngModel",t.editedUser.email),o.xp6(4),o.Q6J("selected",t.findRolesIds(t.editedUser)),o.xp6(1),o.Q6J("ngForOf",t.roles),o.xp6(5),o.Q6J("checked",t.editedUser.enabled))},directives:[d.h8i,b.Fj,b.JJ,b.On,d.jBG,d.fMN,d.t3q,d.rs,n.sg,d.BLq,d.q51],styles:[""]}),e})(),A=(()=>{class e{constructor(e,t,s){this.dialogRef=e,this.userService=t,this.toastrService=s}ngOnInit(){}cancel(){this.dialogRef.close()}update(e){this.userService.put(this.user.id,e).subscribe(t=>{this.toastrService.success("User modified successfuly","SUCCESS"),this.user.id=e.id,this.user.roles=e.roles,this.user.name=e.name,this.user.surname=e.surname,this.user.enabled=e.enabled,this.user.email=e.email,this.dialogRef.close()},e=>{this.toastrService.danger(e.error.message,"ERROR")})}save(){this.form.emitResult()}}return e.\u0275fac=function(t){return new(t||e)(o.Y36(d.X4l),o.Y36(f.mt),o.Y36(d.quB))},e.\u0275cmp=o.Xpm({type:e,selectors:[["ngx-user-edit-form"]],viewQuery:function(e,t){if(1&e&&o.Gf(q,5),2&e){let e;o.iGM(e=o.CRH())&&(t.form=e.first)}},decls:12,vars:2,consts:[[3,"user","roles","userEventEmitter"],[1,"row"],[1,"col","text-center"],["nbButton","","status","danger","outline","",3,"click"],["nbButton","","status","success","outline","",3,"click"]],template:function(e,t){1&e&&(o.TgZ(0,"nb-card"),o.TgZ(1,"nb-card-header"),o._uU(2,"Editar usuario"),o.qZA(),o.TgZ(3,"nb-card-body"),o.TgZ(4,"ngx-user-form",0),o.NdJ("userEventEmitter",function(e){return t.update(e)}),o.qZA(),o.TgZ(5,"div",1),o.TgZ(6,"div",2),o.TgZ(7,"button",3),o.NdJ("click",function(){return t.cancel()}),o._uU(8,"Cancelar"),o.qZA(),o.qZA(),o.TgZ(9,"div",2),o.TgZ(10,"button",4),o.NdJ("click",function(){return t.save()}),o._uU(11,"Guardar"),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o.qZA()),2&e&&(o.xp6(4),o.Q6J("user",t.user)("roles",t.roles))},directives:[d.Asz,d.ndF,d.yKW,q,d.DPz],styles:["nb-card[_ngcontent-%COMP%]{min-width:500px}"]}),e})(),T=(()=>{class e{constructor(e,t,s){this.dialogRef=e,this.userService=t,this.toastrService=s}ngOnInit(){}cancel(){this.dialogRef.close()}submit(){this.userService.resetPassword(this.user.id,this.newPassword).subscribe(e=>this.toastrService.success("Password was modified successfuly","SUCCESS"),e=>{this.toastrService.danger(e.error.message,"ERROR")}),this.dialogRef.close()}}return e.\u0275fac=function(t){return new(t||e)(o.Y36(d.X4l),o.Y36(f.mt),o.Y36(d.quB))},e.\u0275cmp=o.Xpm({type:e,selectors:[["ngx-reset-password-dialog"]],inputs:{user:"user"},decls:15,vars:1,consts:[[1,"m-4"],["for","name"],["id","name","type","password","nbInput","","fullWidth","","status","basic",3,"ngModel","ngModelChange"],[1,"row"],[1,"col","text-center"],["nbButton","","status","danger","outline","",3,"click"],["nbButton","","status","success","outline","",3,"click"]],template:function(e,t){1&e&&(o.TgZ(0,"nb-card"),o.TgZ(1,"nb-card-header"),o._uU(2,"Reset password"),o.qZA(),o.TgZ(3,"nb-card-body"),o.TgZ(4,"div",0),o.TgZ(5,"label",1),o._uU(6,"Nueva contrase\xf1a:"),o.qZA(),o.TgZ(7,"input",2),o.NdJ("ngModelChange",function(e){return t.newPassword=e}),o.qZA(),o.qZA(),o.TgZ(8,"div",3),o.TgZ(9,"div",4),o.TgZ(10,"button",5),o.NdJ("click",function(){return t.cancel()}),o._uU(11,"Cancelar"),o.qZA(),o.qZA(),o.TgZ(12,"div",4),o.TgZ(13,"button",6),o.NdJ("click",function(){return t.submit()}),o._uU(14,"Guardar"),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o.qZA()),2&e&&(o.xp6(7),o.Q6J("ngModel",t.newPassword))},directives:[d.Asz,d.ndF,d.yKW,d.h8i,b.Fj,b.JJ,b.On,d.DPz],styles:[""]}),e})(),U=(()=>{class e{constructor(e){this.httpClient=e}getRoles(){return this.httpClient.get(`${c.N.apiUrl}/api/roles`)}}return e.\u0275fac=function(t){return new(t||e)(o.LFG(u.eN))},e.\u0275prov=o.Yz7({token:e,factory:e.\u0275fac}),e})(),x=(()=>{class e{constructor(e,t){this.dialogService=e,this.roleService=t}ngOnInit(){this.roleService.getRoles().subscribe(e=>this.roles=e,e=>this.roles=[])}openEditDialog(){this.dialogService.open(A,{context:{user:this.user,roles:this.roles}})}resetPassword(){this.dialogService.open(T,{context:{user:this.user}})}}return e.\u0275fac=function(t){return new(t||e)(o.Y36(d.Gln),o.Y36(U))},e.\u0275cmp=o.Xpm({type:e,selectors:[["ngx-user-li"]],inputs:{user:"user"},decls:13,vars:5,consts:[[1,"row","p-3"],[1,"col-1"],[1,"col"],["status","basic","disabled","",3,"checked"],["size","small",1,"ml-auto"],["icon","edit-outline","nbTooltip","Edit user",3,"click"],["icon","unlock-outline","nbTooltip","Reset password",3,"click"],["icon","trash-outline","nbTooltip","Delete user","disabled",""]],template:function(e,t){1&e&&(o.TgZ(0,"div",0),o.TgZ(1,"span",1),o._uU(2),o.qZA(),o.TgZ(3,"span",2),o._uU(4),o.qZA(),o.TgZ(5,"span",2),o._uU(6),o.qZA(),o.TgZ(7,"span",2),o._UZ(8,"nb-toggle",3),o.qZA(),o.TgZ(9,"nb-actions",4),o.TgZ(10,"nb-action",5),o.NdJ("click",function(){return t.openEditDialog()}),o.qZA(),o.TgZ(11,"nb-action",6),o.NdJ("click",function(){return t.resetPassword()}),o.qZA(),o._UZ(12,"nb-action",7),o.qZA(),o.qZA()),2&e&&(o.xp6(2),o.Oqu(t.user.id),o.xp6(2),o.Oqu(t.user.email),o.xp6(2),o.AsE("",t.user.name," ",t.user.surname,""),o.xp6(2),o.Q6J("checked",t.user.enabled))},directives:[d.BLq,d.lYD,d.Bk3,d.jNv],styles:["[_nghost-%COMP%]{width:100%;margin:0}div[_ngcontent-%COMP%]{overflow:hidden}"]}),e})();function w(e,t){if(1&e&&(o.TgZ(0,"nb-list-item",1),o._UZ(1,"ngx-user-li",2),o.qZA()),2&e){const e=t.$implicit;o.xp6(1),o.Q6J("user",e)}}const y=[{path:"",component:m,children:[{path:"logs",component:Z},{path:"users",component:(()=>{class e{constructor(e,t,s){e.getUsers().subscribe(e=>this.users=e,e=>{t.danger(e.error.message,"ERROR")})}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)(o.Y36(f.mt),o.Y36(d.quB),o.Y36(d.Gln))},e.\u0275cmp=o.Xpm({type:e,selectors:[["ngx-users"]],decls:6,vars:1,consts:[["class","p-0",4,"ngFor","ngForOf"],[1,"p-0"],[3,"user"]],template:function(e,t){1&e&&(o.TgZ(0,"nb-card"),o.TgZ(1,"nb-card-header"),o._uU(2,"Usuarios"),o.qZA(),o.TgZ(3,"nb-card-body"),o.TgZ(4,"nb-list"),o.YNc(5,w,2,1,"nb-list-item",0),o.qZA(),o.qZA(),o.qZA()),2&e&&(o.xp6(5),o.Q6J("ngForOf",t.users))},directives:[d.Asz,d.ndF,d.yKW,d.zP_,n.sg,d.qBV,x],styles:["nb-list[_ngcontent-%COMP%]{overflow-x:hidden}"]}),e})()},{path:"**",component:i.w}]}];let C=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=o.oAB({type:e}),e.\u0275inj=o.cJS({imports:[[r.Bz.forChild(y)],r.Bz]}),e})(),_=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=o.oAB({type:e}),e.\u0275inj=o.cJS({imports:[[n.ez,d.V7y,d.KdK,d.IIj,d.wB1,d.nKr,b.u5,d.T2N]]}),e})(),J=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=o.oAB({type:e}),e.\u0275inj=o.cJS({providers:[d.aDd,l,U],imports:[[n.ez,C,d.zyh,d.caZ,d.nKr,d.COg,d.KdK,d.uuI,d.PYG,d.MAY,d.wB1,d.V7y,d.IIj,_,d.T2N,d.rgH,b.u5]]}),e})()}}]);