!function(){function e(e){return function(e){if(Array.isArray(e))return t(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,n){if(!e)return;if("string"==typeof e)return t(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return t(e,n)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}(self.webpackChunkmelodia_ui=self.webpackChunkmelodia_ui||[]).push([[935],{75935:function(t,r,s){"use strict";s.r(r),s.d(r,{AdminModule:function(){return R}});var o=s(38583),u=s(99763),a=s(55477),c=s(37716),l=s(92340),d=s(91841),f=s(86665),g=function(){var e=function(){function e(t,r){var i=this;n(this,e),this.httpClient=t,this.authService=r,this.authService.onTokenChange().subscribe(function(e){i.token=e.getValue()})}return i(e,[{key:"getLogs",value:function(e,t,n){var r="".concat(l.N.apiUrl,"/api/admin/logs/page?");return void 0!==e&&(r+="index=".concat(e,"&")),void 0!==t&&(r+="size=".concat(t,"&")),void 0!==n&&(r+="ascendent=".concat(n,"&")),this.httpClient.get(r,{headers:{Authorization:this.token}})}}]),e}();return e.\u0275fac=function(t){return new(t||e)(c.LFG(d.eN),c.LFG(f._o))},e.\u0275prov=c.Yz7({token:e,factory:e.\u0275fac}),e}(),p=s(13030),h=function(){var e=function(){function e(){n(this,e)}return i(e,[{key:"ngOnInit",value:function(){}},{key:"toNebularStatus",value:function(e){switch(e){case"INFO":return"basic";case"WARN":return"warning";case"ERROR":case"FATAL":return"danger";default:return"basic"}}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=c.Xpm({type:e,selectors:[["ngx-log"]],inputs:{log:"log"},decls:8,vars:4,consts:[[3,"status"],[1,"px-4"]],template:function(e,t){1&e&&(c.TgZ(0,"nb-alert",0),c.TgZ(1,"div"),c.TgZ(2,"span",1),c._uU(3),c.qZA(),c.TgZ(4,"span",1),c._uU(5),c.qZA(),c.TgZ(6,"span",1),c._uU(7),c.qZA(),c.qZA(),c.qZA()),2&e&&(c.Q6J("status",t.toNebularStatus(t.log.status)),c.xp6(3),c.Oqu(t.log.date),c.xp6(2),c.Oqu(t.log.status),c.xp6(2),c.Oqu(t.log.message))},directives:[p.$9b],styles:["[_nghost-%COMP%]{width:100%;margin:0}"]}),e}();function m(e,t){if(1&e&&(c.TgZ(0,"nb-list-item",3),c._UZ(1,"ngx-log",4),c.qZA()),2&e){var n=t.$implicit;c.xp6(1),c.Q6J("log",n)}}function v(e,t){1&e&&(c.TgZ(0,"nb-list-item",5),c._uU(1," Cargando... "),c.qZA())}var Z=function(){var t=function(){function t(e,r){n(this,t),this.adminService=e,this.toastrService=r,this.firstCard={logs:[],placeholders:[],loading:!1,pageToLoadNext:0},this.pageSize=5}return i(t,[{key:"loadNext",value:function(t){var n=this;t.loading||(t.loading=!0,t.placeholders=new Array(this.pageSize),this.adminService.getLogs(t.pageToLoadNext,this.pageSize,!1).subscribe(function(n){var r;t.placeholders=[],(r=t.logs).push.apply(r,e(n.content)),t.loading=!1,t.pageToLoadNext++},function(e){n.toastrService.danger(e.error.message,"ERROR")}))}}]),t}();return t.\u0275fac=function(e){return new(e||t)(c.Y36(g),c.Y36(p.quB))},t.\u0275cmp=c.Xpm({type:t,selectors:[["ngx-logs"]],decls:7,vars:3,consts:[["nbInfiniteList","",3,"threshold","bottomThreshold"],["class","p-0",4,"ngFor","ngForOf"],["nbSpinner","true",4,"ngFor","ngForOf"],[1,"p-0"],[3,"log"],["nbSpinner","true"]],template:function(e,t){1&e&&(c.TgZ(0,"nb-card"),c.TgZ(1,"nb-card-header"),c._uU(2,"Logs"),c.qZA(),c.TgZ(3,"nb-card-body"),c.TgZ(4,"nb-list",0),c.NdJ("bottomThreshold",function(){return t.loadNext(t.firstCard)}),c.YNc(5,m,2,1,"nb-list-item",1),c.YNc(6,v,2,0,"nb-list-item",2),c.qZA(),c.qZA(),c.qZA()),2&e&&(c.xp6(4),c.Q6J("threshold",500),c.xp6(1),c.Q6J("ngForOf",t.firstCard.logs),c.xp6(1),c.Q6J("ngForOf",t.firstCard.placeholders))},directives:[p.Asz,p.ndF,p.yKW,p.zP_,p.sTn,o.sg,p.qBV,h,p.Q7R],styles:["nb-list[_ngcontent-%COMP%]{max-height:500px}"]}),t}(),b=function(){var e=function e(){n(this,e)};return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=c.Xpm({type:e,selectors:[["ngx-admin"]],decls:1,vars:0,template:function(e,t){1&e&&c._UZ(0,"router-outlet")},directives:[u.lC],encapsulation:2}),e}(),A=s(91e3),q=s(3679);function y(e,t){if(1&e){var n=c.EpF();c.TgZ(0,"nb-option",14),c.NdJ("click",function(){var e=c.CHM(n).$implicit;return c.oxw().selectRole(e)}),c._uU(1),c.qZA()}if(2&e){var r=t.$implicit;c.Q6J("value",r.id),c.xp6(1),c.Oqu(r.name)}}var T=function(){var e=function(){function e(){n(this,e),this.userEventEmitter=new c.vpe}return i(e,[{key:"ngOnInit",value:function(){this.editedUser=new A.n5,this.editedUser.id=this.user.id,this.editedUser.name=this.user.name,this.editedUser.roles=this.user.roles,this.editedUser.enabled=this.user.enabled,this.editedUser.email=this.user.email,this.editedUser.surname=this.user.surname}},{key:"findRolesIds",value:function(e){return e.roles.map(function(e){return e.id})}},{key:"selectRole",value:function(e){this.editedUser.roles.filter(function(t){return t.id===e.id}).length>0?this.editedUser.roles=this.editedUser.roles.filter(function(t){return t.id!==e.id}):this.editedUser.roles.push(e)}},{key:"isModified",value:function(){return this.user===this.editedUser}},{key:"emitResult",value:function(){this.userEventEmitter.emit(this.editedUser)}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=c.Xpm({type:e,selectors:[["ngx-user-form"]],inputs:{user:"user",roles:"roles"},outputs:{userEventEmitter:"userEventEmitter"},decls:25,vars:6,consts:[[1,"m-4"],["for","name"],["id","name","type","text","nbInput","","fullWidth","","status","basic",3,"ngModel","ngModelChange"],["for","surname"],["id","surname","type","text","nbInput","","fullWidth","","status","basic",3,"ngModel","ngModelChange"],["for","email"],["nbPrefix","","icon","at-outline"],["id","email","type","email","nbInput","","fullWidth","","status","basic",3,"ngModel","ngModelChange"],["for","roles"],["id","roles","multiple","","fullWidth","",3,"selected"],[3,"value","click",4,"ngFor","ngForOf"],["for","enabled"],["id","enabled"],[3,"checked","checkedChange"],[3,"value","click"]],template:function(e,t){1&e&&(c.TgZ(0,"div"),c.TgZ(1,"div",0),c.TgZ(2,"label",1),c._uU(3,"Nombre:"),c.qZA(),c.TgZ(4,"input",2),c.NdJ("ngModelChange",function(e){return t.editedUser.name=e}),c.qZA(),c.qZA(),c.TgZ(5,"div",0),c.TgZ(6,"label",3),c._uU(7,"Apellidos:"),c.qZA(),c.TgZ(8,"input",4),c.NdJ("ngModelChange",function(e){return t.editedUser.surname=e}),c.qZA(),c.qZA(),c.TgZ(9,"div",0),c.TgZ(10,"label",5),c._uU(11,"Email:"),c.qZA(),c.TgZ(12,"nb-form-field"),c._UZ(13,"nb-icon",6),c.TgZ(14,"input",7),c.NdJ("ngModelChange",function(e){return t.editedUser.email=e}),c.qZA(),c.qZA(),c.qZA(),c.TgZ(15,"div",0),c.TgZ(16,"label",8),c._uU(17,"Roles:"),c.qZA(),c.TgZ(18,"nb-select",9),c.YNc(19,y,2,2,"nb-option",10),c.qZA(),c.qZA(),c.TgZ(20,"div",0),c.TgZ(21,"label",11),c._uU(22,"Enabled:"),c.qZA(),c.TgZ(23,"div",12),c.TgZ(24,"nb-toggle",13),c.NdJ("checkedChange",function(){return t.editedUser.enabled=!t.editedUser.enabled}),c.qZA(),c.qZA(),c.qZA(),c.qZA()),2&e&&(c.xp6(4),c.Q6J("ngModel",t.editedUser.name),c.xp6(4),c.Q6J("ngModel",t.editedUser.surname),c.xp6(6),c.Q6J("ngModel",t.editedUser.email),c.xp6(4),c.Q6J("selected",t.findRolesIds(t.editedUser)),c.xp6(1),c.Q6J("ngForOf",t.roles),c.xp6(5),c.Q6J("checked",t.editedUser.enabled))},directives:[p.h8i,q.Fj,q.JJ,q.On,p.jBG,p.fMN,p.t3q,p.rs,o.sg,p.BLq,p.q51],styles:[""]}),e}(),U=function(){var e=function(){function e(t,r,i){n(this,e),this.dialogRef=t,this.userService=r,this.toastrService=i}return i(e,[{key:"ngOnInit",value:function(){}},{key:"cancel",value:function(){this.dialogRef.close()}},{key:"update",value:function(e){var t=this;this.userService.put(this.user.id,e).subscribe(function(n){t.toastrService.success("User modified successfuly","SUCCESS"),t.user.id=e.id,t.user.roles=e.roles,t.user.name=e.name,t.user.surname=e.surname,t.user.enabled=e.enabled,t.user.email=e.email,t.dialogRef.close()},function(e){t.toastrService.danger(e.error.message,"ERROR")})}},{key:"save",value:function(){this.form.emitResult()}}]),e}();return e.\u0275fac=function(t){return new(t||e)(c.Y36(p.X4l),c.Y36(A.mt),c.Y36(p.quB))},e.\u0275cmp=c.Xpm({type:e,selectors:[["ngx-user-edit-form"]],viewQuery:function(e,t){var n;(1&e&&c.Gf(T,5),2&e)&&(c.iGM(n=c.CRH())&&(t.form=n.first))},decls:12,vars:2,consts:[[3,"user","roles","userEventEmitter"],[1,"row"],[1,"col","text-center"],["nbButton","","status","danger","outline","",3,"click"],["nbButton","","status","success","outline","",3,"click"]],template:function(e,t){1&e&&(c.TgZ(0,"nb-card"),c.TgZ(1,"nb-card-header"),c._uU(2,"Editar usuario"),c.qZA(),c.TgZ(3,"nb-card-body"),c.TgZ(4,"ngx-user-form",0),c.NdJ("userEventEmitter",function(e){return t.update(e)}),c.qZA(),c.TgZ(5,"div",1),c.TgZ(6,"div",2),c.TgZ(7,"button",3),c.NdJ("click",function(){return t.cancel()}),c._uU(8,"Cancelar"),c.qZA(),c.qZA(),c.TgZ(9,"div",2),c.TgZ(10,"button",4),c.NdJ("click",function(){return t.save()}),c._uU(11,"Guardar"),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.qZA()),2&e&&(c.xp6(4),c.Q6J("user",t.user)("roles",t.roles))},directives:[p.Asz,p.ndF,p.yKW,T,p.DPz],styles:["nb-card[_ngcontent-%COMP%]{min-width:500px}"]}),e}(),k=function(){var e=function(){function e(t,r,i){n(this,e),this.dialogRef=t,this.userService=r,this.toastrService=i}return i(e,[{key:"ngOnInit",value:function(){}},{key:"cancel",value:function(){this.dialogRef.close()}},{key:"submit",value:function(){var e=this;this.userService.resetPassword(this.user.id,this.newPassword).subscribe(function(t){return e.toastrService.success("Password was modified successfuly","SUCCESS")},function(t){e.toastrService.danger(t.error.message,"ERROR")}),this.dialogRef.close()}}]),e}();return e.\u0275fac=function(t){return new(t||e)(c.Y36(p.X4l),c.Y36(A.mt),c.Y36(p.quB))},e.\u0275cmp=c.Xpm({type:e,selectors:[["ngx-reset-password-dialog"]],inputs:{user:"user"},decls:15,vars:1,consts:[[1,"m-4"],["for","name"],["id","name","type","password","nbInput","","fullWidth","","status","basic",3,"ngModel","ngModelChange"],[1,"row"],[1,"col","text-center"],["nbButton","","status","danger","outline","",3,"click"],["nbButton","","status","success","outline","",3,"click"]],template:function(e,t){1&e&&(c.TgZ(0,"nb-card"),c.TgZ(1,"nb-card-header"),c._uU(2,"Reset password"),c.qZA(),c.TgZ(3,"nb-card-body"),c.TgZ(4,"div",0),c.TgZ(5,"label",1),c._uU(6,"Nueva contrase\xf1a:"),c.qZA(),c.TgZ(7,"input",2),c.NdJ("ngModelChange",function(e){return t.newPassword=e}),c.qZA(),c.qZA(),c.TgZ(8,"div",3),c.TgZ(9,"div",4),c.TgZ(10,"button",5),c.NdJ("click",function(){return t.cancel()}),c._uU(11,"Cancelar"),c.qZA(),c.qZA(),c.TgZ(12,"div",4),c.TgZ(13,"button",6),c.NdJ("click",function(){return t.submit()}),c._uU(14,"Guardar"),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.qZA()),2&e&&(c.xp6(7),c.Q6J("ngModel",t.newPassword))},directives:[p.Asz,p.ndF,p.yKW,p.h8i,q.Fj,q.JJ,q.On,p.DPz],styles:[""]}),e}(),w=function(){var e=function(){function e(t){n(this,e),this.httpClient=t}return i(e,[{key:"getRoles",value:function(){return this.httpClient.get("".concat(l.N.apiUrl,"/api/roles"))}}]),e}();return e.\u0275fac=function(t){return new(t||e)(c.LFG(d.eN))},e.\u0275prov=c.Yz7({token:e,factory:e.\u0275fac}),e}(),x=function(){var e=function(){function e(t,r){n(this,e),this.dialogService=t,this.roleService=r}return i(e,[{key:"ngOnInit",value:function(){var e=this;this.roleService.getRoles().subscribe(function(t){return e.roles=t},function(t){return e.roles=[]})}},{key:"openEditDialog",value:function(){this.dialogService.open(U,{context:{user:this.user,roles:this.roles}})}},{key:"resetPassword",value:function(){this.dialogService.open(k,{context:{user:this.user}})}}]),e}();return e.\u0275fac=function(t){return new(t||e)(c.Y36(p.Gln),c.Y36(w))},e.\u0275cmp=c.Xpm({type:e,selectors:[["ngx-user-li"]],inputs:{user:"user"},decls:13,vars:5,consts:[[1,"row","p-3"],[1,"col-1"],[1,"col"],["status","basic","disabled","",3,"checked"],["size","small",1,"ml-auto"],["icon","edit-outline","nbTooltip","Edit user",3,"click"],["icon","unlock-outline","nbTooltip","Reset password",3,"click"],["icon","trash-outline","nbTooltip","Delete user","disabled",""]],template:function(e,t){1&e&&(c.TgZ(0,"div",0),c.TgZ(1,"span",1),c._uU(2),c.qZA(),c.TgZ(3,"span",2),c._uU(4),c.qZA(),c.TgZ(5,"span",2),c._uU(6),c.qZA(),c.TgZ(7,"span",2),c._UZ(8,"nb-toggle",3),c.qZA(),c.TgZ(9,"nb-actions",4),c.TgZ(10,"nb-action",5),c.NdJ("click",function(){return t.openEditDialog()}),c.qZA(),c.TgZ(11,"nb-action",6),c.NdJ("click",function(){return t.resetPassword()}),c.qZA(),c._UZ(12,"nb-action",7),c.qZA(),c.qZA()),2&e&&(c.xp6(2),c.Oqu(t.user.id),c.xp6(2),c.Oqu(t.user.email),c.xp6(2),c.AsE("",t.user.name," ",t.user.surname,""),c.xp6(2),c.Q6J("checked",t.user.enabled))},directives:[p.BLq,p.lYD,p.Bk3,p.jNv],styles:["[_nghost-%COMP%]{width:100%;margin:0}div[_ngcontent-%COMP%]{overflow:hidden}"]}),e}();function S(e,t){if(1&e&&(c.TgZ(0,"nb-list-item",1),c._UZ(1,"ngx-user-li",2),c.qZA()),2&e){var n=t.$implicit;c.xp6(1),c.Q6J("user",n)}}var C,_,J=[{path:"",component:b,children:[{path:"logs",component:Z},{path:"users",component:(C=function(){function e(t,r,i){var s=this;n(this,e),t.getUsers().subscribe(function(e){return s.users=e},function(e){r.danger(e.error.message,"ERROR")})}return i(e,[{key:"ngOnInit",value:function(){}}]),e}(),C.\u0275fac=function(e){return new(e||C)(c.Y36(A.mt),c.Y36(p.quB),c.Y36(p.Gln))},C.\u0275cmp=c.Xpm({type:C,selectors:[["ngx-users"]],decls:6,vars:1,consts:[["class","p-0",4,"ngFor","ngForOf"],[1,"p-0"],[3,"user"]],template:function(e,t){1&e&&(c.TgZ(0,"nb-card"),c.TgZ(1,"nb-card-header"),c._uU(2,"Usuarios"),c.qZA(),c.TgZ(3,"nb-card-body"),c.TgZ(4,"nb-list"),c.YNc(5,S,2,1,"nb-list-item",0),c.qZA(),c.qZA(),c.qZA()),2&e&&(c.xp6(5),c.Q6J("ngForOf",t.users))},directives:[p.Asz,p.ndF,p.yKW,p.zP_,o.sg,p.qBV,x],styles:["nb-list[_ngcontent-%COMP%]{overflow-x:hidden}"]}),C)},{path:"**",component:a.w}]}],O=function(){var e=function e(){n(this,e)};return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=c.oAB({type:e}),e.\u0275inj=c.cJS({imports:[[u.Bz.forChild(J)],u.Bz]}),e}(),N=function(){var e=function e(){n(this,e)};return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=c.oAB({type:e}),e.\u0275inj=c.cJS({imports:[[o.ez,p.V7y,p.KdK,p.IIj,p.wB1,p.nKr,q.u5,p.T2N]]}),e}(),R=((_=function e(){n(this,e)}).\u0275fac=function(e){return new(e||_)},_.\u0275mod=c.oAB({type:_}),_.\u0275inj=c.cJS({providers:[p.aDd,g,w],imports:[[o.ez,O,p.zyh,p.caZ,p.nKr,p.COg,p.KdK,p.uuI,p.PYG,p.MAY,p.wB1,p.V7y,p.IIj,N,p.T2N,p.rgH,q.u5]]}),_)}}])}();